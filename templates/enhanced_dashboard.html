<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Bionic Dog Controller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .status-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .status-online {
            background: #4CAF50;
            color: white;
        }
        
        .status-offline {
            background: #f44336;
            color: white;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            padding: 30px;
        }
        
        .control-panel {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }
        
        .panel-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            background: #38a169;
        }
        
        .btn-danger {
            background: #f56565;
            color: white;
        }
        
        .btn-danger:hover:not(:disabled) {
            background: #e53e3e;
        }
        
        .btn-warning {
            background: #ed8936;
            color: white;
        }
        
        .btn-warning:hover:not(:disabled) {
            background: #dd6b20;
        }
        
        .btn-info {
            background: #4299e1;
            color: white;
        }
        
        .btn-info:hover:not(:disabled) {
            background: #3182ce;
        }
        
        .feature-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #cbd5e0;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .toggle-switch.active {
            background: #48bb78;
        }
        
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }
        
        .status-display {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            border: 1px solid #e2e8f0;
        }
        
        .choreography-panel {
            grid-column: span 2;
        }
        
        .choreography-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .input-group select,
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1em;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: 500;
            display: none;
        }
        
        .alert-success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #48bb78;
        }
        
        .alert-error {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #f56565;
        }
        
        .alert-info {
            background: #bee3f8;
            color: #2a4365;
            border-left: 4px solid #4299e1;
        }
        
        .emoji {
            font-size: 1.2em;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .active-feature {
            animation: pulse 2s infinite;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #4a5568;
            margin-top: 5px;
        }
        
        @media (max-width: 1200px) {
            .choreography-panel {
                grid-column: span 1;
            }
        }
        
        @media (max-width: 768px) {
            .control-grid {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            
            .control-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .choreography-buttons {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üêï Enhanced Bionic Dog Controller ü§ñ</h1>
            <p>Control Tom & Jerry with Voice Commands, Object Following, and Dog-to-Dog Communication</p>
            <div class="status-bar">
                <div class="status-indicator" id="tom-status">
                    Tom: <span id="tom-connection">Checking...</span>
                </div>
                <div class="status-indicator" id="jerry-status">
                    Jerry: <span id="jerry-connection">Checking...</span>
                </div>
                <div class="status-indicator" id="system-status">
                    System: <span id="system-connection">Online</span>
                </div>
            </div>
        </div>

        <div class="control-grid">
            <!-- Basic Movement Controls -->
            <div class="control-panel">
                <h3 class="panel-title">
                    <span class="emoji">üéÆ</span> Basic Controls
                </h3>
                
                <div class="input-group">
                    <label for="dog-select">Select Dog:</label>
                    <select id="dog-select">
                        <option value="tom">Tom</option>
                        <option value="jerry">Jerry</option>
                        <option value="both">Both Dogs</option>
                    </select>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-primary" onclick="sendCommand('forward')">‚¨ÜÔ∏è Forward</button>
                    <button class="btn btn-primary" onclick="sendCommand('left')">‚¨ÖÔ∏è Left</button>
                    <button class="btn btn-primary" onclick="sendCommand('right')">‚û°Ô∏è Right</button>
                    <button class="btn btn-primary" onclick="sendCommand('reverse')">‚¨áÔ∏è Reverse</button>
                    <button class="btn btn-danger" onclick="sendCommand('stop')">üõë Stop</button>
                    <button class="btn btn-info" onclick="sendCommand('initpos')">üè† Home</button>
                </div>
                
                <div class="status-display" id="basic-status">
                    Ready for commands
                </div>
            </div>

            <!-- Action Commands -->
            <div class="control-panel">
                <h3 class="panel-title">
                    <span class="emoji">üé≠</span> Action Commands
                </h3>
                
                <div class="control-buttons">
                    <button class="btn btn-success" onclick="sendCommand('handshake')">ü§ù Handshake</button>
                    <button class="btn btn-success" onclick="sendCommand('bow')">üôè Bow</button>
                    <button class="btn btn-success" onclick="sendCommand('jump')">ü¶ò Jump</button>
                    <button class="btn btn-success" onclick="sendCommand('hiphop')">üíÉ Hip Hop</button>
                    <button class="btn btn-success" onclick="sendCommand('ssdance')">üï∫ SS Dance</button>
                    <button class="btn btn-success" onclick="sendCommand('staylow')">‚¨áÔ∏è Stay Low</button>
                </div>
                
                <div class="status-display" id="action-status">
                    Ready for actions
                </div>
            </div>

            <!-- Voice Control -->
            <div class="control-panel">
                <h3 class="panel-title">
                    <span class="emoji">üéôÔ∏è</span> Voice Control
                </h3>
                
                <div class="feature-toggle">
                    <span>Voice Recognition</span>
                    <div class="toggle-switch" id="voice-toggle" onclick="toggleVoiceControl()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <div class="alert alert-success" id="voice-alert">
                    Voice control is active. Say commands like "Tom forward" or "Both dogs dance"
                </div>
                
                <div class="status-display" id="voice-commands">
                    Available commands:<br>
                    ‚Ä¢ "Tom/Jerry [movement]"<br>
                    ‚Ä¢ "Both dogs [action]"<br>
                    ‚Ä¢ "Stop all"<br>
                    ‚Ä¢ "Dance sequence"<br>
                    <br>
                    Status: <span id="voice-status-text">Inactive</span>
                </div>
            </div>

            <!-- Object Following -->
            <div class="control-panel">
                <h3 class="panel-title">
                    <span class="emoji">üëÅÔ∏è</span> Object Following
                </h3>
                
                <div class="input-group">
                    <label for="target-type">Target Type:</label>
                    <select id="target-type">
                        <option value="face">Face Detection</option>
                        <option value="red">Red Objects</option>
                        <option value="blue">Blue Objects</option>
                        <option value="green">Green Objects</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="follow-dog">Following Dog:</label>
                    <select id="follow-dog">
                        <option value="tom">Tom</option>
                        <option value="jerry">Jerry</option>
                    </select>
                </div>
                
                <button class="btn btn-success" id="start-following" onclick="toggleObjectFollowing()">
                    üéØ Start Following
                </button>
                
                <div class="status-display" id="following-stats">
                    Following: <span id="following-status-text">Inactive</span><br>
                    Targets detected: <span id="targets-count">0</span><br>
                    Distance: <span id="target-distance">N/A</span>
                </div>
            </div>

            <!-- Dog Communication -->
            <div class="control-panel">
                <h3 class="panel-title">
                    <span class="emoji">üì°</span> Dog-to-Dog Communication
                </h3>
                
                <div class="feature-toggle">
                    <span>Communication Active</span>
                    <div class="toggle-switch" id="comm-toggle" onclick="toggleCommunication()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="sync-action">Synchronized Action:</label>
                    <select id="sync-action">
                        <option value="handshake">Handshake</option>
                        <option value="bow">Bow Together</option>
                        <option value="ssdance">Dance Sequence</option>
                        <option value="jump">Jump Together</option>
                        <option value="initpos">Return Home</option>
                    </select>
                </div>
                
                <button class="btn btn-info" onclick="sendSyncCommand()">
                    üîÑ Execute Synchronized
                </button>
                
                <div class="status-display" id="comm-status">
                    Communication: <span id="comm-status-text">Inactive</span><br>
                    Last sync: <span id="last-sync">None</span><br>
                    Messages sent: <span id="messages-count">0</span>
                </div>
            </div>

            <!-- Session Statistics -->
            <div class="control-panel">
                <h3 class="panel-title">
                    <span class="emoji">üìä</span> Session Statistics
                </h3>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="commands-sent">0</div>
                        <div class="stat-label">Commands Sent</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="voice-commands">0</div>
                        <div class="stat-label">Voice Commands</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="sync-actions">0</div>
                        <div class="stat-label">Sync Actions</div>
                    </div>
                </div>
                
                <div class="status-display" id="session-info">
                    Session started: <span id="session-start">Loading...</span><br>
                    Uptime: <span id="session-uptime">0s</span>
                </div>
            </div>

            <!-- Enhanced Choreography -->
            <div class="control-panel choreography-panel">
                <h3 class="panel-title">
                    <span class="emoji">üé™</span> Enhanced Choreography
                </h3>
                
                <div class="choreography-buttons">
                    <button class="btn btn-warning" onclick="performChoreography('handshake')">
                        ü§ù Enhanced Handshake
                    </button>
                    <button class="btn btn-warning" onclick="performChoreography('disco')">
                        üï∫ Disco Party
                    </button>
                    <button class="btn btn-warning" onclick="performChoreography('mirror')">
                        ü™û Mirror Dance
                    </button>
                    <button class="btn btn-warning" onclick="performChoreography('chase')">
                        üèÉ Chase Game
                    </button>
                </div>
                
                <div class="status-display" id="choreography-status">
                    Ready for choreography commands<br>
                    Last performance: <span id="last-choreography">None</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let features = {
            voice: false,
            following: false,
            communication: false
        };

        let sessionStats = {
            commands_sent: 0,
            voice_commands: 0,
            sync_actions: 0,
            start_time: new Date()
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateConnectionStatus();
            setInterval(updateStatus, 3000);
            setInterval(updateUptime, 1000);
        });

        // Send basic commands
        function sendCommand(action) {
            const dog = document.getElementById('dog-select').value;
            const url = dog === 'both' ? `/control/both/${action}` : `/control/${dog}/${action}`;
            
            // Disable button temporarily
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => btn.disabled = true);
            
            fetch(url, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    showNotification(data.status === 'success' ? 'success' : 'error', 
                                   `${action} command sent to ${dog}`);
                    
                    document.getElementById('basic-status').innerHTML = 
                        `Last: ${action} ‚Üí ${dog} (${data.status})`;
                })
                .catch(error => {
                    showNotification('error', 'Failed to send command');
                })
                .finally(() => {
                    // Re-enable buttons
                    setTimeout(() => {
                        buttons.forEach(btn => btn.disabled = false);
                    }, 500);
                });
        }

        // Toggle voice control
        function toggleVoiceControl() {
            const endpoint = features.voice ? '/api/voice/stop' : '/api/voice/start';
            
            fetch(endpoint, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    features.voice = data.active;
                    updateVoiceUI();
                    showNotification('success', data.message);
                })
                .catch(error => {
                    showNotification('error', 'Voice control error');
                });
        }

        // Toggle object following
        function toggleObjectFollowing() {
            const targetType = document.getElementById('target-type').value;
            const dog = document.getElementById('follow-dog').value;
            
            if (features.following) {
                fetch('/api/following/stop', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        features.following = false;
                        updateFollowingUI();
                        showNotification('success', 'Object following stopped');
                    });
            } else {
                fetch('/api/following/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ target_type: targetType, dog: dog })
                })
                .then(response => response.json())
                .then(data => {
                    features.following = data.active || false;
                    updateFollowingUI();
                    showNotification(data.status === 'success' ? 'success' : 'error', data.message);
                });
            }
        }

        // Toggle communication
        function toggleCommunication() {
            fetch('/api/communication/start', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    features.communication = data.active;
                    updateCommunicationUI();
                    showNotification('success', data.message);
                })
                .catch(error => {
                    showNotification('error', 'Communication error');
                });
        }

        // Send synchronized command
        function sendSyncCommand() {
            const action = document.getElementById('sync-action').value;
            
            fetch('/api/communication/sync', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: action })
            })
            .then(response => response.json())
            .then(data => {
                showNotification(data.status === 'success' ? 'success' : 'error', data.message);
                document.getElementById('last-sync').textContent = action;
            });
        }

        // Perform choreography
        function performChoreography(type) {
            document.getElementById('choreography-status').innerHTML = 
                `Performing ${type} choreography...`;
                
            fetch(`/choreography/${type}`)
                .then(response => response.json())
                .then(data => {
                    showNotification('success', `${type} choreography completed`);
                    document.getElementById('last-choreography').textContent = type;
                    setTimeout(() => {
                        document.getElementById('choreography-status').innerHTML = 
                            `Ready for choreography commands<br>Last performance: <span id="last-choreography">${type}</span>`;
                    }, 3000);
                });
        }

        // Update UI functions
        function updateVoiceUI() {
            const toggle = document.getElementById('voice-toggle');
            const alert = document.getElementById('voice-alert');
            const statusText = document.getElementById('voice-status-text');
            
            if (features.voice) {
                toggle.classList.add('active');
                alert.style.display = 'block';
                statusText.textContent = 'Active - Listening';
                statusText.style.color = '#38a169';
            } else {
                toggle.classList.remove('active');
                alert.style.display = 'none';
                statusText.textContent = 'Inactive';
                statusText.style.color = '#e53e3e';
            }
        }

        function updateFollowingUI() {
            const button = document.getElementById('start-following');
            const statusText = document.getElementById('following-status-text');
            
            if (features.following) {
                button.textContent = 'üõë Stop Following';
                button.className = 'btn btn-danger';
                statusText.textContent = 'Active';
                statusText.style.color = '#38a169';
            } else {
                button.textContent = 'üéØ Start Following';
                button.className = 'btn btn-success';
                statusText.textContent = 'Inactive';
                statusText.style.color = '#e53e3e';
            }
        }

        function updateCommunicationUI() {
            const toggle = document.getElementById('comm-toggle');
            const statusText = document.getElementById('comm-status-text');
            
            if (features.communication) {
                toggle.classList.add('active');
                statusText.textContent = 'Active';
                statusText.style.color = '#38a169';
            } else {
                toggle.classList.remove('active');
                statusText.textContent = 'Inactive';
                statusText.style.color = '#e53e3e';
            }
        }

        // Update connection status
        function updateConnectionStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    // Update connection indicators
                    const tomStatus = document.getElementById('tom-status');
                    const jerryStatus = document.getElementById('jerry-status');
                    
                    tomStatus.className = data.connections.tom ? 'status-indicator status-online' : 'status-indicator status-offline';
                    jerryStatus.className = data.connections.jerry ? 'status-indicator status-online' : 'status-indicator status-offline';
                    
                    document.getElementById('tom-connection').textContent = data.connections.tom ? 'Online' : 'Offline';
                    document.getElementById('jerry-connection').textContent = data.connections.jerry ? 'Online' : 'Offline';
                    
                    // Update feature status
                    features = data.features;
                    updateVoiceUI();
                    updateFollowingUI();
                    updateCommunicationUI();
                    
                    // Update statistics
                    if (data.session_stats) {
                        document.getElementById('commands-sent').textContent = data.session_stats.commands_sent;
                        document.getElementById('voice-commands').textContent = data.session_stats.voice_commands;
                        document.getElementById('sync-actions').textContent = data.session_stats.sync_actions;
                    }
                })
                .catch(error => {
                    console.error('Status update failed:', error);
                    document.getElementById('system-connection').textContent = 'Error';
                });
        }

        // Update status periodically
        function updateStatus() {
            updateConnectionStatus();
            
            // Update following statistics
            if (features.following) {
                fetch('/api/following/status')
                    .then(response => response.json())
                    .then(data => {
                        if (data.status && data.status.statistics) {
                            const stats = data.status.statistics;
                            document.getElementById('targets-count').textContent = stats.total_detections || 0;
                        }
                    })
                    .catch(error => console.log('Following status update failed'));
            }
        }

        // Update session uptime
        function updateUptime() {
            const now = new Date();
            const diff = Math.floor((now - sessionStats.start_time) / 1000);
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const seconds = diff % 60;
            
            let uptime = '';
            if (hours > 0) uptime += `${hours}h `;
            if (minutes > 0) uptime += `${minutes}m `;
            uptime += `${seconds}s`;
            
            document.getElementById('session-uptime').textContent = uptime;
            
            if (!document.getElementById('session-start').textContent.includes(':')) {
                document.getElementById('session-start').textContent = 
                    sessionStats.start_time.toLocaleTimeString();
            }
        }

        // Show notifications
        function showNotification(type, message) {
            // Remove existing notifications
            const existingNotif = document.querySelector('.notification');
            if (existingNotif) {
                existingNotif.remove();
            }
            
            // Create notification
            const notification = document.createElement('div');
            notification.className = `notification alert alert-${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
            
            // Also log to console
            console.log(`${type.toUpperCase()}: ${message}`);
        }
    </script>
</body>
</html>
